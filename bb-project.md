# Техническое задание: Тестовое приложение с кеширующим слоем

## Задача

Необходимо развернуть тестовое приложение с кеширующим слоем. Оно состоит из четырёх основных компонентов:

1. **База данных PostgreSQL**
2. **Backend API на Go**
3. **Redis**
4. **Прокси-приложение на Python (Flask)**

### Логика работы

Внешние пользователи обращаются в **прокси**. Прокси проверяет наличие запрашиваемых данных в **Redis**.
- Если данные найдены – сразу возвращает их клиенту.
- Если данных нет – прокси запрашивает их у **Backend API**, которое ходит в **PostgreSQL** и возвращает результат. Прокси сохраняет данные в Redis и отдаёт клиенту.

---

## Что нужно сделать

1. **Развернуть виртуальные машины:**
- Можно поднять **2 ВМ**: на одной – Backend + PostgreSQL, на второй – Redis + прокси.
- Либо развернуть **4 ВМ**, каждая под один компонент (PostgreSQL, Backend, Redis, Proxy).
- Для backend использовать **Ubuntu**, для прокси – **CentOS**.

2. **Настроить сетевое взаимодействие (оформить в отдельный файл `rules.sh`):**
- Прокси принимает запросы от любого источника.
- Прокси имеет доступ к Redis и Backend.
- Backend принимает запросы **только** от прокси.
- Backend имеет доступ только к PostgreSQL.
- PostgreSQL принимает подключения только от Backend.

3. **Подготовить базу данных:**
- Установить PostgreSQL версии **15+**.
- Создать БД `test`.
- Создать таблицу `users`:
```sql
CREATE TABLE users (
id SERIAL PRIMARY KEY,
name VARCHAR(50),
age INT,
email VARCHAR(100)
);
```
- Заполнить таблицу данными из предоставленного CSV (20 записей).

4. **Установить Redis версии 7+.**

5. **Собрать пакеты приложений:**
- Для Backend – **.deb пакет** (Ubuntu).
- Для Proxy – **.rpm пакет** (CentOS).
- Пакет должен содержать systemd unit для управления сервисом через `systemctl`.
- Сохранить спецификации пакетов (control-файл для .deb и spec-файл для .rpm) в каталоге проекта.

6. **Установить собранные пакеты на ВМ.**

7. **Запустить Backend API и Proxy API как systemd сервисы.**

8. **Проверить работу:**
1. С прокси ВМ выполнить `curl` на Backend и убедиться, что API отвечает.
2. Выполнить запрос к прокси:
```bash
curl http://<ip-прокси>:<порт-прокси>/user?id=5
```
Ожидаемый ответ:
```json
{"cached":false,"user":{"id":5,"name":"Charlie Davis","age":35}}
```
3. Повторный запрос должен вернуть тот же объект, но с `"cached": true`.
4. Запросы, нарушающие сетевую топологию (например, к backend напрямую с любого другого IP), должны блокироваться.

9. **Сохранить результаты:**
- Файл `rules.sh` и спецификации пакетов (control и spec файлы) должны быть сохранены в отдельном репозитории.
- В итоговом отчёте указать ссылку на репозиторий.
- В отчёт приложить **скриншоты**, подтверждающие работоспособность приложения (curl-запросы, логи systemctl, работающие сервисы и т.п.).